---
title: Hurricane Effect on Water Quality
title-block-banner: "dark"
author: "William Mullins"
theme: flatly
format: 
  html:
    ouput-file: "paper.html"
---

```{r}
#| include: false

library(here)
library(janitor)
library(tidyverse)
library(lubridate)
library(patchwork)
library(viridis)
library(hrbrthemes)

# Load functions 
source("../R/roll_mean.R")
source("../R/weeks_since_start.R")
source("../R/weeks_to_dates.R")
source("../R/create_combined_graph.R")
```

<h1>Background</h1>
Schaefer et al. (
<a href="https://eds-214-workflows-reproducibility.github.io/course-materials/interactive/interactive-day1am.html#ref-schaefer2000" role="doc-biblioref" data-original-href="https://eds-214-workflows-reproducibility.github.io/course-materials/interactive/interactive-day1am.html#ref-schaefer2000" aria-expanded="false">2000</a>
)
conducted a long-term investigation into the effects of Hurricane Hugo on the water quality of streams in Puerto Rico. They did this by continuously taking measurements of the water's composition after the hurricane hit, which could then be compared against measurements taken years prior. It is the goal of this project to recreate the third figure found in the aforementioned research paper. 
<h1>Data</h1>

Of the measurements they took, the ones of interest to the project are the milligrams of potassium (K), nitrate (NO3), calcium (Ca), magnesium (Mg), and ammonia (NH4). Using the dates attached to these measurements, the rolling means of each variable were calculated and subsequently plotted. 

```{r, echo = FALSE}
# Read in clean data
merged_data_frame <- read.csv(here::here("outputs", "clean_data.csv"))
merged_data_frame$date <-lubridate::as_date(merged_data_frame$date)

# View
data_sub <- head(merged_data_frame) 
knitr::kable(data_sub, digits = 3)
```

<h1>Methods</h1>
In order to find the rolling mean, the data was first formatted to have an additional column containing the number of weeks between the initial observation and the current observation. This task was implemented in the function weeks_since_start. After that, the data frame is inserted into the roll_mean function, which calculates the mean value of each column in 4.5-week intervals and 9-week windows. Data frame output by that function then has its week column converted back into dates using the weeks_to_dates function. The data frames are then merged. Using the create_combined_graphs function, graphs of each of the five variables are made using ggplot, and they are then merged using patchwork, creating a stack of plots.

<h1>Results</h1>

```{r, echo = FALSE, warning=FALSE}
# Plotting the data
# Runs the testing file
merged_plots <- create_combined_graph(merged_data_frame) + plot_layout(axes = "collect", guides = "collect") & 
  theme(plot.margin = unit(c(0.1,0.1,0.1,0.1), "cm"), 
        axis.title.x = element_text(hjust = 0.5, size = 15))


merged_plots 
 
ggsave(plot = merged_plots, here::here("outputs", "figs", "merged_plots.jpg"), width = 6, height = 4)

```

<a href="https://github.com/willrmull/eds-214-water-quality" class="btn btn-lg btn-primary">View Repository on Github</a>
